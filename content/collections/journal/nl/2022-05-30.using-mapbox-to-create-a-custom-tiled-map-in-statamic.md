---
id: d04fce9a-a5f7-41a6-b768-ec41b462c5f4
blueprint: journal
title: 'Using Mapbox to create a custom tiled map in Statamic'
seo_noindex: false
seo_nofollow: false
seo_canonical_type: entry
sitemap_change_frequency: weekly
sitemap_priority: 0.5
updated_by: b40458fa-e73a-4f88-bfa1-570cd54b72e0
updated_at: 1653945418
tags:
  - mapbox
  - statamic
  - js
image: journal/mapbox/mapbox-statamic-nieuw-allardsoog.png
page_builder:
  -
    article:
      -
        type: paragraph
        content:
          -
            type: text
            text: 'For the '
          -
            type: text
            marks:
              -
                type: link
                attrs:
                  href: 'https://nieuw-allardsoog.nl'
                  rel: noopener
                  target: _blank
                  title: null
            text: 'Nieuw Allardsoog'
          -
            type: text
            text: ' website '
          -
            type: text
            marks:
              -
                type: link
                attrs:
                  href: 'https://strikwerda.info'
                  rel: noopener
                  target: _blank
                  title: null
            text: 'Meinte Strikwerda'
          -
            type: text
            text: ' drew a beautiful illustration of the estate. The goal of this post is to make the below illustration interactive, zoomable, and filled with interactive points of interest.'
      -
        type: set
        attrs:
          values:
            type: figure
            image: journal/mapbox/map-nieuw-allardsoog-meinte-strikwerda.jpg
            size: lg
            style: color
            browser_frame: false
            caption: 'The original illustration by Meinte Strikerda'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'In the end I ended up with the '
          -
            type: text
            marks:
              -
                type: link
                attrs:
                  href: 'https://nieuw-allardsoog.nl/#map'
                  rel: noopener
                  target: _blank
                  title: null
            text: 'following result'
          -
            type: text
            text: '. A completely interactive, tiled, zoomable map with points of interests visitors can explore. '
      -
        type: heading
        attrs:
          level: 2
        content:
          -
            type: text
            text: 'What do we need to do'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'In order to render a custom interactive map using Statamic you need to do a few things. For this post you should have some knowledge on Statamic and Javascript. '
      -
        type: paragraph
        content:
          -
            type: text
            text: 'These are the steps we need to take:'
      -
        type: ordered_list
        attrs:
          order: 1
        content:
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    text: 'Tiling the map'
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    text: 'Initiate Mapbox'
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    text: 'Combine Statamic and Mapbox'
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    text: 'Icing on the cake'
      -
        type: heading
        attrs:
          level: 2
        content:
          -
            type: text
            text: 'Tiling the map'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'To let Mapbox use a custom map instead of a geographical world map you have to generate squared tiles for various zoom levels. To automate this you can use a CLI tool called '
          -
            type: text
            marks:
              -
                type: link
                attrs:
                  href: 'https://github.com/jahed/maptiles'
                  rel: noopener
                  target: _blank
                  title: null
            text: Maptiles
          -
            type: text
            text: '. Since this is probably a one-off thing you don''t have to worry about installing it in your $PATH but simply reference the shell script directly. Run the following command in your terminal.'
      -
        type: set
        attrs:
          values:
            type: code
            size: md
            code:
              code: 'sh maptiles map.png --square --format jpg --optimise lossless --background ''#FAF3E4'' ./mapbox'
              mode: shell
            caption: 'Run this command in your terminal.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'This will convert '
          -
            type: text
            marks:
              -
                type: code
            text: map.png
          -
            type: text
            text: ' to whole bunch of tiles in the folder '
          -
            type: text
            marks:
              -
                type: code
            text: ./mapbox
          -
            type: text
            text: '. The files will be squared, lossless and jpg''s. With the '
          -
            type: text
            marks:
              -
                type: code
            text: background
          -
            type: text
            text: ' flag you define a background color to the tiles when there''s no art on that square. The tiles will be enclosed in folders with the zoom level as their name:'
      -
        type: set
        attrs:
          values:
            type: code
            size: md
            code:
              code: |-
                \tiles
                \tiles\0\
                \tiles\0\tile_0_0.jpg
                \tiles\1\
                \tiles\1\tile_0_0.jpg
                \tiles\1\tile_0_1.jpg
                \tiles\1\tile_1_0.jpg
                \tiles\1\tile_1_1.jpg
                ...
              mode: markdown
            caption: 'The file system structure we end up with.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'Put all those files somewhere in the '
          -
            type: text
            marks:
              -
                type: code
            text: public
          -
            type: text
            text: ' folder of your Statamic install or on a CDN.'
      -
        type: heading
        attrs:
          level: 2
        content:
          -
            type: text
            text: 'Initiating Mapbox'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'Mapbox is commercial software but you can use it for free until 50.000 views per month. The advantage of Mapbox is that it''s not a Google product and that it''s very good looking and customizable. '
          -
            type: text
            marks:
              -
                type: link
                attrs:
                  href: 'https://account.mapbox.com/auth/signup/'
                  rel: noopener
                  target: _blank
                  title: null
            text: 'Create an account'
          -
            type: text
            text: ' and set up an access token.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'For this feature you need the Mapbox GL JS scripts. Include these in the partial where you''ll be rendering the final map. I''m rendering the partial on each page. In the end I use a JS event so that the modal and map can be opened from anywhere.'
      -
        type: set
        attrs:
          values:
            type: code
            size: md
            code:
              code: |-
                <link href="https://api.mapbox.com/mapbox-gl-js/v2.4.1/mapbox-gl.css" rel="stylesheet">
                <script src="https://api.mapbox.com/mapbox-gl-js/v2.4.1/mapbox-gl.js"></script>
              mode: htmlmixed
            caption: 'Include the Mapbox JS and CSS files in your '
      -
        type: paragraph
        content:
          -
            type: text
            text: 'In order to use our Access Token from a '
          -
            type: text
            marks:
              -
                type: code
            text: .env
          -
            type: text
            text: ' variable we have to add an array to the Laravel services config file. This is '
          -
            type: text
            marks:
              -
                type: code
            text: config/services.php
          -
            type: text
            text: '. Add the following:'
      -
        type: set
        attrs:
          values:
            type: code
            size: md
            code:
              code: |-
                'mapbox' => [
                	'key' => env('MAPBOX_KEY'),
                ]
              mode: php
            caption: 'Update the Laravel services config to reference your Acces Token.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'Now you can add '
          -
            type: text
            marks:
              -
                type: code
            text: MAPBOX_KEY=YOUR_ACCESS_TOKEN
          -
            type: text
            text: ' to your '
          -
            type: text
            marks:
              -
                type: code
            text: .env
          -
            type: text
            text: ' file.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'Now everything is setup you can start by using AlpineJS to initiate the map. '
      -
        type: set
        attrs:
          values:
            type: code
            size: md
            code:
              code: |-
                // Load the Access Token. [tl! highlight:1]
                mapboxgl.accessToken = '{{ config:services:mapbox:key }}'
                const map = new mapboxgl.Map({
                  container: 'map',
                  style: {
                    'version': 8,
                    'sources': {
                      'raster-tiles': {
                        'type': 'raster',
                        'tiles': [
                          // Use the custom map tiles. [tl! highlight:1]
                          'PATH_TO_YOUR_TILES/{z}/tile_{x}_{y}.jpg'
                        ],
                        // Divide the actual tile size in pixels by 2 to support retina displays. [tl! highlight:1]
                        'tileSize': 128,
                        'attribution': ''
                      }
                    },
                    'layers': [
                      {
                        'id': 'simple-tiles',
                        'type': 'raster',
                        'source': 'raster-tiles',
                        // Set the amount of zoom levels (folders) available in your tileset. [tl! highlight:2]
                        'minzoom': 0,
                        'maxzoom': 6
                      }
                    ]
                  },
                  renderWorldCopies: false,
                  // Default zoom.[tl! highlight:5]
                  zoom: 2,
                  // The minimum zoom available.
                  minZoom: 2,
                  // The maximum zoom available.
                  maxZoom: 5
                })
              mode: javascript
            caption: 'Initiate the Mapbox map with Javascript and use the custom tiles.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'So what''s happening here?'
      -
        type: ordered_list
        attrs:
          order: 1
        content:
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: L12
                  -
                    type: text
                    text: ' I reference the previously generated tiles. Make sure to update the path. '
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: L15
                  -
                    type: text
                    text: ' I set the tile size. As the generated images are actually '
                  -
                    type: text
                    marks:
                      -
                        type: code
                    text: '256px x 256px'
                  -
                    type: text
                    text: ' I want to render them at '
                  -
                    type: text
                    marks:
                      -
                        type: code
                    text: '128px x 128px'
                  -
                    type: text
                    text: ' to support retina displays.'
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: 'L25:26'
                  -
                    type: text
                    text: ' I set the amount of zoom levels available in our tile set. This the amount of zoom folders that get generated: '
                  -
                    type: text
                    marks:
                      -
                        type: code
                    text: '[0] [1] [2] [3] [4] [5] [6]'
                  -
                    type: text
                    text: .
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: 'L32:36'
                  -
                    type: text
                    text: ' I configure the default zoom level and the amount of zoom levels I want the user to be able to control. '
                  -
                    type: text
                    marks:
                      -
                        type: italic
                    text: 'Note:'
                  -
                    type: text
                    text: ' this will make the tiles in the unused zoom levels redundant.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'After setting up this basis you can set some specific UI options. '
      -
        type: set
        attrs:
          values:
            type: code
            size: md
            code:
              code: |-
                // Disable the UI compass.
                const nav = new mapboxgl.NavigationControl({
                  showCompass: false
                })

                // Add controls to the bottom right of the map.
                map.addControl(nav, 'bottom-right')

                // Disable rotation.
                map.touchZoomRotate.disableRotation()
                map.dragRotate.disable()
              mode: javascript
            caption: 'Configure the Mapbox UI.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'I like the interface as clean as possible so I configure the following.'
      -
        type: ordered_list
        attrs:
          order: 1
        content:
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: L3
                  -
                    type: text
                    text: ' Disable compass UI.'
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: L7
                  -
                    type: text
                    text: ' Move the zoom controls to the bottom right.'
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: 'L10:11'
                  -
                    type: text
                    text: ' Disable rotation. It makes no sense for users being to rotate such a map. I also disable rotation via drag gestures on touch devices.'
      -
        type: heading
        attrs:
          level: 2
        content:
          -
            type: text
            text: 'Combine Statamic and Mapbox'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'The next step is to generate dots on the map that serve as points of interest the user can click on. I decided to generate a Statamic Collection for this to make adding points to the map a breeze. I created a collection called  called '
          -
            type: text
            marks:
              -
                type: code
            text: map_features
          -
            type: text
            text: '. Depending on your needs your collection blueprint might look different, but this is a screenshot of the editing experience for my collection.'
      -
        type: set
        attrs:
          values:
            type: figure
            image: journal/mapbox/map-features-collection.png
            size: lg
            style: color
            caption: 'The Statamic Control Panel collection blueprint.'
            browser_frame: true
      -
        type: paragraph
        content:
          -
            type: text
            text: 'You might note that each entry will get '
          -
            type: text
            marks:
              -
                type: code
            text: longitude
          -
            type: text
            text: ' and '
          -
            type: text
            marks:
              -
                type: code
            text: latitude
          -
            type: text
            text: ' values. Mapbox needs to know where on the map you want a certain dot plotted. So we need to find a way to get those values. For this I added this snippet to my partial:'
      -
        type: set
        attrs:
          values:
            type: code
            size: md
            code:
              code: |-
                {{ if environment == 'local' }}
                	map.on('mousemove', (e) => {
                		console.log(JSON.stringify(e.lngLat.wrap()))
                	})
                {{ /if }}
              mode: javascript
            caption: 'environment is available in statamic and it comes from the .env file.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'This way when you inspect the map (on a local environment) and hover over it you get live coordinates of where we you''re hovering. Handy! Simply copy the values for each point of interest and add them as a collection entry with all the other fields you need for your project.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'The last thing we need to do is instruct Mapbox to plot those points of interest on the map. First we should define how our dots on the map visually look. I copied and tweaked an example from the Mapbox Documentation that ended me up with following code.'
      -
        type: set
        attrs:
          values:
            type: code
            size: md
            code:
              code: |-
                // This implements `StyleImageInterface` to draw a pulsing dot icon on the map.
                const pulsingDot = {
                    width: 200,
                    height: 200,
                    data: new Uint8Array(size * size * 4),

                    // When the layer is added to the map, get the rendering context for the map canvas.
                    onAdd: function () {
                        const canvas = document.createElement('canvas')
                        canvas.width = this.width
                        canvas.height = this.height
                        this.context = canvas.getContext('2d')
                    },

                    // Call once before every frame where the icon will be used.
                    render: function () {
                        const duration = 1200
                        const t = (performance.now() % duration) / duration

                        const radius = (size / 2) * 0.3
                        const outerRadius = (size / 2) * 0.7 * t + radius
                        const context = this.context

                        // Draw the outer circle.
                        context.clearRect(0, 0, this.width, this.height)
                        context.beginPath()
                        context.arc(this.width / 2, this.height / 2, outerRadius, 0, Math.PI * 2)
                        context.fillStyle = `rgba(255, 200, 200, ${1 - t})`
                        context.fill()

                        // Draw the inner circle.
                        context.beginPath()
                        context.arc(
                            this.width / 2,
                            this.height / 2,
                            radius,
                            0,
                            Math.PI * 2
                        )
                        context.fillStyle = '#4C2D6D' // [tl! highlight:1]
                        context.strokeStyle = '#B98BE9'
                        context.lineWidth = 2 + 4 * (1 - t)
                        context.fill()
                        context.stroke()

                        // Update this image's data with data from the canvas.
                        this.data = context.getImageData(
                            0,
                            0,
                            this.width,
                            this.height
                        ).data

                        // Continuously repaint the map, resulting in the smooth animation of the dot.
                        map.triggerRepaint()

                        // Return `true` to let the map know that the image was updated.
                        return true
                    }
                }
              mode: javascript
            caption: 'Set up a constant to use as dots for our points of interest.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'This snippet is using the '
          -
            type: text
            marks:
              -
                type: code
            text: canvas
          -
            type: text
            text: ' API to draw a pulsating dot optimized for retina screens. You can '
          -
            type: text
            marks:
              -
                type: link
                attrs:
                  href: 'https://docs.mapbox.com/mapbox-gl-js/example/add-image-animated/'
                  rel: noopener
                  target: _blank
                  title: null
            text: 'read the original documentation'
          -
            type: text
            text: ' on this. The most important thing you''d want to change is the coloring to match your projects branding on'
          -
            type: text
            marks:
              -
                type: bold
            text: ' L40:41'
          -
            type: text
            text: .
      -
        type: paragraph
        content:
          -
            type: text
            text: 'For each collection entry this dot needs to be rendered. You can do this by simply looping over your collection with Antlers tags.'
      -
        type: set
        attrs:
          values:
            type: code
            size: md
            code:
              code: |-
                map.on('load', () => {
                    map.addImage('pulsing-dot', pulsingDot, { pixelRatio: 2 })

                    map.addSource('features', {
                        'type': 'geojson',
                        'data': {
                            'type': 'FeatureCollection',
                            'features': [
                              	// Use Antlers to loop over our map_features collection. [tl! highlight:13]
                                {{ collection:map_features }}
                                    {
                                        'type': 'Feature',
                                        'properties': {
                              							// Define the HTML that should be rendered when a user clicks.
                                            'description': '<div class="absolute flex flex-col font-serif py-1 px-8 bottom-0 inset-x-0 text-center mb-6 bg-neutral-400/70"><h3 class="text-creme font-bold text-sm">{{ title }}</h3>{{ if entry || external_link }}<a class="text-creme font-bold text-xs underline" href="{{ entry:url ?? external_link }}" {{ if external_link }} target="_blank" {{ /if}} aria-label="Read more about {{ title }}">Read more</a>{{ /if }}</div><img class="w-full h-full" src="{{ glide src="{{ image }}" width="600" height="600" fit="crop_focal" }}" alt="{{ image:alt }}" aria-hidden="true">'
                                        },
                                        'geometry': {
                                            'type': 'Point',
                                            'coordinates': [{{ longitude }}, {{ latitude }}]
                                        }
                                    },
                                {{ /collection:map_features }}
                            ]
                        }
                    })
                    map.addLayer({
                        'id': 'features',
                        'type': 'symbol',
                        'source': 'features',
                        'layout': {
                            'icon-image': 'pulsing-dot'
                        }
                    })
                })
              mode: javascript
            caption: 'Use the Antlers collection tag to loop over all points of interests and render them on the map as a pulsing dot.'
      -
        type: ordered_list
        attrs:
          order: 1
        content:
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    text: 'The most important bit here is '
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: 'L9:16'
                  -
                    type: text
                    text: '. I''m using the Statamic '
                  -
                    type: text
                    marks:
                      -
                        type: link
                        attrs:
                          href: 'https://statamic.dev/tags/collection'
                          rel: noopener
                          target: _blank
                          title: null
                    text: 'collection tag'
                  -
                    type: text
                    text: ' to fetch all of our map features.'
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: 'L15 '
                  -
                    type: text
                    text: 'is the HTML that should be visible whenever the dot gets clicked on in the next step. I''d probably put this HTML in a separate partial for clarity next time. '
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    text: 'On '
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: 'L19 '
                  -
                    type: text
                    text: 'we instruct Mapbox on which coordinates to render the pulsating dot ('
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: L35
                  -
                    type: text
                    text: '). '
      -
        type: paragraph
        content:
          -
            type: text
            text: 'To make sure to get a pointer cursor when the user hovers over a pulsating dot add the following.'
      -
        type: set
        attrs:
          values:
            type: code
            size: md
            code:
              code: |-
                // Change the cursor to a pointer when the mouse is over the places layer.
                map.on('mouseenter', 'features', () => {
                    map.getCanvas().style.cursor = 'pointer'
                })

                // Change it back to a pointer when it leaves.
                map.on('mouseleave', 'features', () => {
                    map.getCanvas().style.cursor = ''
                })
              mode: javascript
            caption: 'Use JS/CSS to change the the cursor when hovering over a dot.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'The map is almost done. The last thing you should do is make the dots interactive and to let them show the primitive HTML we wrote in the snippet above. This snippet is also based on the great Mapbox documentation.'
      -
        type: set
        attrs:
          values:
            type: code
            size: md
            code:
              code: |-
                // When a click event occurs on a feature in the places layer, open a popup at the
                // location of the feature, with description HTML from its properties.
                map.on('click', 'features', (e) => {
                    // Copy coordinates array.
                    const coordinates = e.features[0].geometry.coordinates.slice()
                    const description = e.features[0].properties.description

                    // Ensure that if the map is zoomed out such that multiple
                    // copies of the feature are visible, the popup appears
                    // over the copy being pointed to.
                    while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                        coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360
                    }

                    map.flyTo({
                        center: e.features[0].geometry.coordinates
                    })

                    new mapboxgl.Popup()
                        .setLngLat(coordinates)
                        .setHTML(description)
                        .addTo(map)
                    }
                )
              mode: javascript
            caption: 'Make the points of interest interactive.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'What happens here is the following.'
      -
        type: ordered_list
        attrs:
          order: 1
        content:
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: 'L4:6 '
                  -
                    type: text
                    text: 'On click get the '
                  -
                    type: text
                    marks:
                      -
                        type: code
                    text: coördinates
                  -
                    type: text
                    text: ' and '
                  -
                    type: text
                    marks:
                      -
                        type: code
                    text: description
                  -
                    type: text
                    text: '  (the HTML) from the pulsating dot. '
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: 'L8:13 '
                  -
                    type: text
                    text: 'Zoom out the map so the popup will fit. '
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: 'L15:17 '
                  -
                    type: text
                    text: 'Center the map on the clicked dot.'
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: 'L19:23 '
                  -
                    type: text
                    text: 'Render the Mapbox Popup using the '
                  -
                    type: text
                    marks:
                      -
                        type: code
                    text: coördinates
                  -
                    type: text
                    text: ' and '
                  -
                    type: text
                    marks:
                      -
                        type: code
                    text: description
                  -
                    type: text
                    text: '. '
      -
        type: heading
        attrs:
          level: 2
        content:
          -
            type: text
            text: 'Icing on the cake'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'The map on the Nieuw Allardsoog site renders in a modal. For this we can use AlpineJS. I use the following markup.'
      -
        type: set
        attrs:
          values:
            type: code
            size: md
            code:
              code: |-
                <section
                    x-data="map()"
                    x-bind="component"
                    x-cloak
                    class="relative z-50"
                >
                    <div class="fixed inset-0 bg-neutral motion-safe:transition-opacity motion-safe:duration-600">

                    <div class="fixed inset-4 md:inset-6 lg:inset-8 bg-creme rounded-md overflow-hidden">
                        <div class="relative w-full h-full">
                            <div id="map" class="relative w-full h-full bg-creme"></div>
                        </div>
                    </div>

                    <button
                    	x-bind="button"
                      class="absolute top-2 right-2 md:top-4 md:right-4 lg:top-6 lg:right-6 w-10 h-10 flex items-center justify-center rounded shadow bg-primary-600 hover:bg-primary-400 active:bg-primary-600 border-t border-b border-t-white/10 border-b-black/10 focus:outline-none focus-visible:ring ring-primary motion-safe:transition-colors"
                      aria-label="Close map"
                      >
                        {{ svg:close class="w-5 h-5 text-creme stroke-current" alt="" aria-hidden="true" }}
                    </button>
                </section>
              mode: handlebars
            caption: 'The Antlers markup template responsible for rendering a modal with the map.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'Note that we''re spreading all the Alpine properties using '
          -
            type: text
            marks:
              -
                type: code
            text: x-bind
          -
            type: text
            text: '. This will separate concerns in our partial a little and it gives us syntax highlighting.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'And the following JS logic.'
      -
        type: set
        attrs:
          values:
            type: code
            size: md
            code:
              code: |-
                window.map = function () {
                    return {
                      	// The modal is closed by default.
                        open: false,
                      	// The map should only be rendered once. [tl! highlight:1]
                        rendered: false,
                        component: {
                          	// Show the modal when this.open.
                            'x-show'() {
                                return this.open
                            },
                          	// Open the map from a URL hash. [tl! highlight:11]
                            'x-init'() {
                                return window.location.hash === '#map'
                                    ? (this.open = true, this.$nextTick(() => { setTimeout(() => { this.renderMap(), this.rendered = true }, 300) }))
                                    : this.open = false
                            },
                          	// Update the URL hash.
                            'x-effect'() {
                                return this.open
                                    ? history.pushState({}, '', '#map')
                                    : history.pushState({}, '', window.location.pathname)
                            },
                          	// Focus trap the modal.
                            'x-trap.inert.noscroll'() {
                                return this.open
                            },
                          	// Listen to an open-map event and when it's dispatched open the modal and render the map. [tl! highlight:5]
                            '@open-map.window'() {
                                return this.rendered
                                    ? this.open = true
                                    : (this.open = true, this.$nextTick(() => { setTimeout(() => { this.renderMap(), this.rendered = true }, 300) }))
                            },
                          	// Close the map with escape.
                            '@keydown.window.escape'() {
                                this.open = false
                            }
                        },
                        button: {
                          	// The close button in the modal.
                            '@click'() {
                                this.open = false
                            }
                        },
                        renderMap() {
                            // All of the above Mapbox logic.
                        }
                    }
                }
              mode: javascript
            caption: 'The AlpineJS logic for opening and closing the modal and rendering the map.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'For me AlpineJS makes interactivity like this so easy to implement. Let''s dive into a few more complex lines.'
      -
        type: ordered_list
        attrs:
          order: 1
        content:
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: 'L6 '
                  -
                    type: text
                    text: 'Mapbox should only be initiated once and not again when a user opens the modal for the second time. '
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: 'L12:23 '
                  -
                    type: text
                    text: 'Use the '
                  -
                    type: text
                    marks:
                      -
                        type: code
                    text: history
                  -
                    type: text
                    text: ' API to update and listen to the URL. Whenever the hash '
                  -
                    type: text
                    marks:
                      -
                        type: code
                    text: '#map'
                  -
                    type: text
                    text: ' is in the URL the modal should open automatically. This is being taken care of in '
                  -
                    type: text
                    marks:
                      -
                        type: code
                    text: x-init
                  -
                    type: text
                    text: '. It renders the map after a little delay to make sure the modal is fully rendered. We also set '
                  -
                    type: text
                    marks:
                      -
                        type: code
                    text: this.rendered
                  -
                    type: text
                    text: ' to true so the map doesn''t need to be initialized again later on. The '
                  -
                    type: text
                    marks:
                      -
                        type: code
                    text: x-effect
                  -
                    type: text
                    text: ' attribute takes care of removing the hash from the URL whenever to modal is closed. '
          -
            type: list_item
            content:
              -
                type: paragraph
                content:
                  -
                    type: text
                    marks:
                      -
                        type: bold
                    text: 'L28:33 '
                  -
                    type: text
                    text: 'Whenever the '
                  -
                    type: text
                    marks:
                      -
                        type: code
                    text: open-map
                  -
                    type: text
                    text: ' event is dispatched the modal will open and if the map hasn''t been rendered yet the function '
                  -
                    type: text
                    marks:
                      -
                        type: code
                    text: renderMap()
                  -
                    type: text
                    text: ' will run as well.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'To dispatch this event add the following AlpineJS code on any button on your site.'
      -
        type: set
        attrs:
          values:
            type: code
            size: md
            code:
              code: |-
                <button x-data="" @click.prevent="$dispatch('open-map')">
                	Open map
                </button>
              mode: htmlmixed
            caption: 'Invoke the map by dispatching a JS event.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'And that''s it. We''ve added a fully custom map to our website and use live data from Statamic to make it interactive. Check out the '
          -
            type: text
            marks:
              -
                type: link
                attrs:
                  href: 'https://nieuw-allardsoog.nl/#map'
                  rel: noopener
                  target: _blank
                  title: null
            text: 'live result'
          -
            type: text
            text: ' here.'
      -
        type: paragraph
        content:
          -
            type: text
            text: 'If you liked this post or have any comments, please let me know on '
          -
            type: text
            marks:
              -
                type: link
                attrs:
                  href: 'https://twitter.com/studio1902'
                  rel: noopener
                  target: _blank
                  title: null
            text: Twitter
          -
            type: text
            text: '. '
    background_text_position: start
    type: article
    enabled: true
author: b40458fa-e73a-4f88-bfa1-570cd54b72e0
user:
  - b40458fa-e73a-4f88-bfa1-570cd54b72e0
og_image: using-mapbox-to-create-a-custom-tiled-map-in-statamic-og-1653340599.png
twitter_image: using-mapbox-to-create-a-custom-tiled-map-in-statamic-twitter-1653340599.png
language: en
---
